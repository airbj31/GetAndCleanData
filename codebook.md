# codebook for Final Program Assignment of Getting and Cleaning DATA course on Coursera.org.
Byungju Kim  
2016년 2월 28일  

# Introduction

 One of the most exciting areas in all of data science right now is wearable computing. Companies like Fitbit, Nike, and Jawbone Up are racing to develop the most advanced algorithms to attract new users.
   
  **getting and cleaning data** is most basic and fundamental process for it. As a part of programming assignment provided by Johns hopkins university on coursera, we are now under test and evaluation if we can get and clean data from raw data.
  
  raw data can be downloaded from 
  
  https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip
   
  A full description is available at the site where the data was obtained:

  http://archive.ics.uci.edu/ml/datasets/Human+Activity+Recognition+Using+Smartphones
  
  In this codebook, I'll describe the cleaned data what I made from raw data and show how I get and clean it.

# DATA description.

tidyGalaxy is a first tidy data set which contains numerous observation and 5 columns. this is huge data set over 600MB. so we can print it into file. the dataset would be described in tidyGalaxy description section.

tidyGalaxySummary is a summarized data set from tidyGalaxy.

Both of them are generated by running **run_analysis.R** 

only difference of them are observation number and value of mean and std column because tidyGalaxySummary is summarized by dplyr.

the summarized data set was written in **[UCISamsungGalaxySIISummary.txt](https://github.com/airbj31/GetAndCleanData/blob/master/UCISamsungGalaxySIISummary.txt)** in your local working directory after running run_analysis.R


## data set :: tidyGalaxy description

- **sampleid**
    
    sampleid is unique identifier assigend to each people who participated the study.

- **measurement** (33 values)

    the values of "measurement" is a measurement method named as **[prefix][measurement][signal]**
  
    It is somewhat confused since the value itself has different information. 
    but I considered the value is just one measurement which indicated only one value what original investigators measured. 
  
    The definition of each portion of value names are followings:

    - prefix
        - **t**  : time domain signals which were captured at a constant rate of 50 Hz.
        - **f**  : Fast Fourier Transform (FFT) was applied.

    - signal - dimensional signals.
        - **X** : Measurement of X signal
        - **Y** : Measurement of Y signal
        - **Z** : Measurement of Z signal
        - **NA(nothing)** : indicated summarized measurement.
    
    - measurement
        - **BodyAcc** : body acceleration for each of 3 dimensional signals (X/Y/Z).
        - **GravityAcc** : gravity acceleration for each signals (X/Y/Z).
        - **BodyAccJerk** : Jerk signal from body linear acceleration for X/Y/Z.
        - **BodyGyro** : body angular velocity for each signals (X/Y/Z)
        - **BodyGyroJerk** : Jerk signals from body angular velocity for X/Y/Z.
        - **BodyAccMag** : Euclidean normalized tree-dimensional signal for 3 BodyAcc measurement.
        - **GravityAccMag** : Euclidean normalized tree-dimensional signal for 3 GravityAcc measurement.
        - **BodyAccJerkMag** : Euclidean normalized tree-dimensional signal for 3 BodyAccJerk measurement
        - **BodyGyroMag** : Euclidean normalized tree-dimensional signal for 3 BodyGyro measurement
        - **BodyGyroJerkMag** : Euclidean normalized tree-dimensional signal for 3 BodyGyroJerk measurement.
        
    - **activity** 

        measured activity by the smartphone.
        the activity containing **laying**, **sitting**, **standing**, **walking_downstairs** and **walking_upstairs**.

    - **mean** : extracted mean() value for the measurement variable.
    
    - **std** :  extracted standard deviation for the measurement variable.




## data set :: tidyGalaxySummary (written in UCISamsungGalaxySIISummary.txt) description

- **sampleid**
    
    sampleid is unique identifier assigend to each people who participated the study.

- **activity** 

    measured activity by the smartphone.
    the activity containing **laying**, **sitting**, **standing**, **walking_downstairs** and **walking_upstairs**.

- **mean** : mean of extracted mean() value based on sampleid and activity column 
  
    note that the mean is calculated by regardless of measurement from tidyGalaxy data set
    
- **std** :  mean of extracted standard deviation based on sampleid and activity column 

    note that the mean of std is calculated by regardless of measurement from tidyGalaxy data set

# Workflows and detailed code description

## Understanding about the data

  * **features.txt** List of all variables ( 561 x 2 ). this file is used to extract column name.

  * **activity_labels.txt** code and activity label (6 x 2). Since the order of the items are same with line-number, we do not need to use 1st column. we need simple function which redirects the code's real activity (see num2act(x) in run_analysis.R). 

  * **train/X_train.txt** and **test/X_test.txt** Training and Test set data (train/X_train.txt : 7352 x 561; test_X_test.txt : 2947 x 561). 
  
      Each row identifies the subject who performed the activity for each window sample. 
      Its range is from 1 to 30.
      
      there is no common id between train and test set.
      
  * **train/Y_train.txt** and **test/Y_test.txt** 
  
      number codes ( train/Y_train.txt :7352 x 1; test/Y_test.txt : 2947 x 1) for activity label.
      the number codes are converted into human readable one later part of the data processing.

## Make strategy to get and clean data.

1. **features.txt** would be used to column name.
2. **train** and **test** data should be separately handled and merged since their observation numbers are different. 
3. use dplyr and tidyr to make tidy data an make summary.

## Step 0. Data download and load library

  In this step we first load required library for data analysis and download data from web.


```r
  ## 0-A. Load Library 

  require(dplyr)
  require(tidyr)

  ## 0-B. Initial variable declaration

    ## declare fileURL for download data
    fileURL<-"https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"
  
    ## declare data folder 
    dir<-"data"

    ## downloaded zip file name
    dfile<-"LastPA.zip"
  
  ## 0-C check directory existence
  if(!file.exists(dir)) {
    dir.create(dir)  ## if directory is not exists, make one.  
  }
  
  ## 0-D. download and unzip data
    
    ## make dest file path and name
    dfile2<-paste(dir,dfile,sep="/")

    ## etc. download file unzip it into dir folder.(for testing purpose do not download again.)
    #  if(!file.exists(dfile2) | !file.info(dfile2)$size == 62556944)
    #  {download.file(fileURL,destfile=dfile2);unzip(dfile2,exdir=dir)}
    
    ## download file
    download.file(fileURL,destfile=dfile2)

    ## unzip downloaded file into dir folder.
    unzip(dfile2,exdir=dir)

  ## 0-E. set base data directory as dir variable for further usage. 
    dir<-paste(dir,"UCI HAR Dataset",sep="/")
```

## Step 1. Read Data and merge.them

in this step, We read 3 data frames from test and training directory and merge them into one temporary data frame.


```r
  ## 1. Define function for merging data 
  
  ## alternatively, we can use join(), join_all(), arrange() function.
  
  Merge3DF <-function(dirPATH,File1,File2,File3,...)
  {
    filePATH<-paste(dirPATH,File1,sep="/")
    df1<-read.table(filePATH,...)
    filePATH<-paste(dirPATH,File2,sep="/")
    df2<-read.table(filePATH,...)
    filePATH<-paste(dirPATH,File3,sep="/")
    df3<-read.table(filePATH,...)
    
    ## Merge 3 data into 1 data.frame
    cbind(df1,df2,df3)
  }

    ## get merged train and test set.
    merged.train<-Merge3DF(dir,"train/subject_train.txt","train/y_train.txt","train/X_train.txt",header=FALSE)
    merged.test <-Merge3DF(dir,"test/subject_test.txt","test/y_test.txt","test/X_test.txt",header=FALSE)
  
    ## Merge train and test set
    merged.df<-rbind(merged.train,merged.test)
    
    ## remove temporary train and test data.
    rm(merged.train, merged.test)
```

## Step 2. Extracts only the measurements on the mean and standard deviation for each measurement.


```r
  ## 2-A. read column information.
  filePATH<-paste(dir,"features.txt",sep="/")
  VarColname<-as.vector(read.table(filePATH,header=FALSE)[2]$V2)

  ## 2-B. declare colname of merged.df.  
  colnames(merged.df)<-c("sampleid","activity",VarColname)

  ## 2-C. Extracts only the measurements on the mean and standard deviation for each measurement.
  ExtColName<-grep("-mean\\(\\)|-std\\(\\)",VarColname)
  ExtColName<-VarColname[ExtColName]
  
  ## 2-D. to avoid duplicated related error of dplyr select function
  merged.df <- merged.df[,!duplicated(names(merged.df))]
  merged.df <- select(merged.df, one_of(c("sampleid","activity",ExtColName)))
```

## Step 3. Uses descriptive activity names to name the activities in the data set


```r
  ## 3-A. read activity_label to label activity column.
  
  filePATH<-paste(dir,"activity_labels.txt",sep="/")
  activity <- as.vector(read.table(filePATH,col.names = c("id","activity"))[2]$activity)

  ## 3-B. make simple function which redirect input's human readable activiy.
  num2act <-function(x)
  {
    tolower(activity[x])  
  }
  
  ## 3-C. use mutate function to change column value.
  new.df<-mutate(merged.df,activity=num2act(merged.df$activity))

  ## 3-D. remove temporary data table. 
  rm(merged.df)
```


## Step 4. Appropriately labels the data set with descriptive variable names.

- I used piping and dplyr and tidyr package to tidify data.
  - gather function is used to melt data set and make new columns named mean and std repectively.
  - select function is used to drop unneccesary variable
  - mutate used to change variable name to be more descriptive and readable by using sub() with regex.


```r
  ## Using tidyr and dplyr, clean the data.
  tidyGalaxy  <- new.df  %>% gather(measurement, mean ,contains("mean()")) %>% 
                      gather(measurement2, std ,contains("std()"))  %>% 
                      select(-measurement2) %>%
                      mutate(measurement=sub("-mean\\(\\)-*","",measurement))
```

## Step 5. make summary data set.

- From the data set in step 4, creates a second, independent tidy data set with the average of each variable for each activity and each subject.


```r
  tidyGalaxySummary <- tidyGalaxy %>% group_by(sampleid,activity) %>% summarize(mean=mean(mean),std=mean(std))
  print(tidyGalaxySummary) 
  
  ## save the file 
   write.table(tidyGalaxySummary,file = "./data/UCISamsungGalaxySIISummary.txt",row.names = FALSE)
#  write.table(tst,file = "./data/UCISamsungGalaxySII.txt")
```
